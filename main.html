<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MY LIBRARY | 개발자를 위한 서점</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2232/2232688.png">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

  <div class="top-bar">
    <div class="top-right">
      <a href="#">회원가입</a><span>|</span><a href="#">로그인</a><span>|</span><a href="#">장바구니</a>
    </div>
  </div>

  <header>
    <div class="logo">MY LIBRARY</div>

    <div class="header-search">
      <input type="text" id="header-search-input" placeholder="도서 검색...">
      <button onclick="headerSearch()" class="header-search-btn">
        <i class="fas fa-search"></i>
      </button>
    </div>
    <nav>
      <ul>
        <li><a href="products.html?query=베스트셀러">베스트셀러</a></li>
        <li><a href="products.html?query=소설">소설</a></li>
        <li><a href="products.html?query=인문">인문/사회</a></li>
        <li><a href="products.html?query=IT">IT/과학</a></li>
        <li><a href="products.html?query=경제">경제/경영</a></li>
        <li><a href="products.html?query=자기계발">자기계발</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="banner">
      <div class="banner-content">
        <h2>DAILY READING, DAILY GROWTH</h2>
        <p>오늘의 지혜를 찾으세요.<br>다양한 분야의 신간 도서가 가득합니다!</p>
        <a href="products.html?query=IT" class="btn-banner">서재 둘러보기</a>
      </div>
    </section>

    <section class="product-list">
      <h2>화제의 신간 도서</h2>
      <p style="text-align: center; color: #666; margin-bottom: 20px;">지금 가장 주목받는 책들을 만나보세요.</p>

      <div class="slider-viewport">
        <div id="slider-track" class="slider-track"></div>
      </div>

      <p id="loading-message" style="text-align:center; width:100%; color:#888;">
        <i class="fas fa-spinner fa-spin"></i> 도서 정보를 불러오고 있습니다...
      </p>
    </section>
  </main>

  <div id="book-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div class="modal-body">
        <img id="modal-image" src="" alt="책 표지">
        <div class="modal-text">
          <h3 id="modal-title">책 제목</h3>
          <p id="modal-author" class="meta">저자 | 출판사</p>
          <p id="modal-price" class="price">₩0</p>
          <div class="divider"></div>
          <p id="modal-description">상세 설명...</p>
          <a id="modal-link" href="#" target="_blank" class="btn-link">네이버 상세페이지 이동</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 MY LIBRARY (SONG DONG IN). All rights reserved.</p>
  </footer>

  <script>
    let currentBooks = [];
    let slideInterval;

    document.addEventListener('DOMContentLoaded', () => {
      fetchBooks('신간 도서');
      
      // [추가] 헤더 검색창 엔터키
      document.getElementById('header-search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') headerSearch();
      });
    });

    // [추가] 헤더 검색 함수
    function headerSearch() {
      const keyword = document.getElementById('header-search-input').value;
      if (!keyword.trim()) {
        alert('검색어를 입력하세요');
        return;
      }
      window.location.href = `products.html?query=${keyword}`;
    }

    function fetchBooks(query) {
      const track = document.getElementById('slider-track');
      const loadingMsg = document.getElementById('loading-message');

      clearInterval(slideInterval);
      track.style.transform = 'translateX(0px)';
      track.innerHTML = '';
      
      if (loadingMsg) loadingMsg.style.display = 'block';

      // 메인 슬라이더는 12개 정도만 가져오면 충분
      fetch(`/api/search/naver-books?query=${query}&display=12`)
        .then(res => res.json())
        .then(data => {
          if (loadingMsg) loadingMsg.style.display = 'none';
          const books = data.items;
          currentBooks = books;

          if (!books || books.length === 0) {
            track.innerHTML = '<p>도서 데이터가 없습니다.</p>';
            return;
          }

          books.forEach((book, index) => {
            const bookCard = document.createElement('div');
            bookCard.className = 'product-card';

            const cleanTitle = book.title.replace(/<[^>]*>/g, "");
            const formattedPrice = parseInt(book.price).toLocaleString();

            bookCard.innerHTML = `
              <div class="img-wrapper">
                <img src="${book.image}" alt="${cleanTitle}" class="product-image">
              </div>
              <h3 class="product-title">${cleanTitle}</h3>
              <p class="product-price">₩${formattedPrice}</p>
              <button class="btn-cart" onclick="openModal(${index})">상세보기</button>
            `;
            track.appendChild(bookCard);
          });
          startSlider(track, books.length);
        })
        .catch(err => { console.error(err); });
    }

    function startSlider(track, totalItems) {
      let currentIndex = 0;
      const cardWidth = 300; 
      const visibleItems = 4;

      slideInterval = setInterval(() => {
        currentIndex++;
        if (currentIndex > totalItems - visibleItems) {
          currentIndex = 0;
        }
        const newPosition = -(currentIndex * cardWidth);
        track.style.transform = `translateX(${newPosition}px)`;
      }, 3000);

      track.addEventListener('mouseenter', () => clearInterval(slideInterval));
      track.addEventListener('mouseleave', () => {
        slideInterval = setInterval(() => {
          currentIndex++;
          if (currentIndex > totalItems - visibleItems) currentIndex = 0;
          track.style.transform = `translateX(${-currentIndex * cardWidth}px)`;
        }, 3000);
      });
    }

    function openModal(index) {
      const book = currentBooks[index];
      if (!book) return;
      document.getElementById('modal-image').src = book.image;
      document.getElementById('modal-title').innerText = book.title.replace(/<[^>]*>/g, "");
      document.getElementById('modal-author').innerText = `${book.author} | ${book.publisher}`;
      document.getElementById('modal-price').innerText = `₩${parseInt(book.price).toLocaleString()}`;
      document.getElementById('modal-description').innerText = book.description ? book.description.replace(/<[^>]*>/g, "") : "내용 없음";
      document.getElementById('modal-link').href = book.link;
      document.getElementById('book-modal').classList.remove('hidden');
    }
    function closeModal() { document.getElementById('book-modal').classList.add('hidden'); }
    window.onclick = function(e) { if(e.target == document.getElementById('book-modal')) closeModal(); }
  </script>
</body>
</html>